<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="noodp"/><title>Spark Operator æµ…æ | </title><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>
<meta name="twitter:title" content="Spark Operator æµ…æ"/>
<meta name="twitter:description" content="æœ¬æ–‡æ€»ç»“äº† Spark è®¡ç®—æ¡†æ¶çš„åŸºç¡€æ¶æ„ï¼Œä»‹ç»äº† Spark on K8s çš„å¤šç§æ–¹æ¡ˆï¼Œç€é‡ä»‹ç»äº† Spark Operator çš„è®¾è®¡å’Œå®ç°ã€‚"/><meta name="Description" content="æœ¬æ–‡æ€»ç»“äº† Spark è®¡ç®—æ¡†æ¶çš„åŸºç¡€æ¶æ„ï¼Œä»‹ç»äº† Spark on K8s çš„å¤šç§æ–¹æ¡ˆï¼Œç€é‡ä»‹ç»äº† Spark Operator çš„è®¾è®¡å’Œå®ç°ã€‚"><meta property="og:title" content="Spark Operator æµ…æ" />
<meta property="og:description" content="æœ¬æ–‡æ€»ç»“äº† Spark è®¡ç®—æ¡†æ¶çš„åŸºç¡€æ¶æ„ï¼Œä»‹ç»äº† Spark on K8s çš„å¤šç§æ–¹æ¡ˆï¼Œç€é‡ä»‹ç»äº† Spark Operator çš„è®¾è®¡å’Œå®ç°ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dcoliversun.github.io/spark-operator-brief-analysis/" /><meta property="og:image" content="https://dcoliversun.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-21T10:04:49+08:00" />
<meta property="article:modified_time" content="2021-09-21T10:04:49+08:00" />

<meta name="application-name" content="@Qian Sun">
<meta name="apple-mobile-web-app-title" content="@Qian Sun"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
        <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://dcoliversun.github.io/spark-operator-brief-analysis/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/lib/prismjs/prism.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Spark Operator æµ…æ",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/dcoliversun.github.io\/spark-operator-brief-analysis\/"
        },"genre": "posts","keywords": "Spark, Operator, Kubernetes","wordCount":  3698 ,
        "url": "https:\/\/dcoliversun.github.io\/spark-operator-brief-analysis\/","datePublished": "2021-09-21T10:04:49+08:00","dateModified": "2021-09-21T10:04:49+08:00",
        "publisher": {
            "@type": "Person",
            "name": "", "image": [
            {
            "@type": "ImageObject",
            "url": "https:\/\/dcoliversun.github.io\/images\/me\/avatar.png"
            }
            ]},"author": {
                "@type": "Person",
                "name": ""
            },"description": "æœ¬æ–‡æ€»ç»“äº† Spark è®¡ç®—æ¡†æ¶çš„åŸºç¡€æ¶æ„ï¼Œä»‹ç»äº† Spark on K8s çš„å¤šç§æ–¹æ¡ˆï¼Œç€é‡ä»‹ç»äº† Spark Operator çš„è®¾è®¡å’Œå®ç°ã€‚"
    }
    </script><script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "ä¸»é¡µ",
            "item": "https:\/\/dcoliversun.github.io"
        },{
            "@type": "ListItem",
            "position": 2,
            "name": "Apache Spark",
            "item": "https://dcoliversun.github.io/categories/apache-spark/"
        },{
                "@type": "ListItem",
                "position": 3,
                "name": "Spark Operator æµ…æ"
            }]
    }
</script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header>
    <div class="desktop header" id="header-desktop">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="@Qian Sun" class="header-logo logo-svg">@Qian Sun</a>
            </div>
            <div class="menu">
                <nav>
                    <h2 class="display-hidden">ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ</h2>
                    <ul class="menu-inner"><li>
                            <a class="menu-item" href="/posts/"> Posts </a>
                        </li><li>
                            <a class="menu-item" href="/tags/"> Tags </a>
                        </li><li>
                            <a class="menu-item" href="/categories/"> Categories </a>
                        </li><li>
                            <a class="menu-item" href="/donate"> Donate </a>
                        </li><li>
                            <a class="menu-item" href="/about"> About </a>
                        </li></ul>
                </nav><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <span class="svg-icon icon-search"></span>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <span class="svg-icon icon-cancel"></span>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <span class="svg-icon icon-loading"></span>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <span class="svg-icon icon-moon"></span>
                </a>
            </div>
        </div>
    </div><div class="mobile header" id="header-mobile">
        <div class="header-container">
            <div class="header-wrapper">
                <div class="header-title">
                    <a href="/" title="@Qian Sun" class="header-logo">@Qian Sun</a>
                </div>
                <div class="menu-toggle" id="menu-toggle-mobile">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <div class="menu" id="menu-mobile"><div class="search-wrapper">
                        <div class="search mobile" id="search-mobile">
                            <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                                <span class="svg-icon icon-search"></span>
                            </a>
                            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                                <span class="svg-icon icon-cancel"></span>
                            </a>
                            <span class="search-button search-loading" id="search-loading-mobile">
                                <span class="svg-icon icon-loading"></span>
                            </span>
                        </div>
                        <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                            å–æ¶ˆ
                        </a>
                    </div><nav>
                    <h2 class="display-hidden">ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ</h2>
                    <ul><li>
                            <a class="menu-item" href="/posts/" title="">Posts</a>
                        </li><li>
                            <a class="menu-item" href="/tags/" title="">Tags</a>
                        </li><li>
                            <a class="menu-item" href="/categories/" title="">Categories</a>
                        </li><li>
                            <a class="menu-item" href="/donate" title="">Donate</a>
                        </li><li>
                            <a class="menu-item" href="/about" title="">About</a>
                        </li></ul>
                </nav>
                <a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <span class="svg-icon icon-moon"></span>
                </a></div>
        </div>
    </div><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div></header><main class="main">
<div class="container content-article page-toc theme-full"><div class="toc" id="toc-auto">
            <div class="toc-title">ç›®å½•</div>
            <div class="toc-content" id="toc-content-auto"></div>
        </div>
    

    
    
    <article>
    

        <header class="header-post">

            

            
            <div class="featured-image" style="background-image: url('/images/202109/spark-operator-brief-analysis/preview.png');"><div class="post-title">

                    <div class="post-all-meta">
                        <nav class="breadcrumbs">
    <ol>
        <li><a href="/">ä¸»é¡µ </a></li><li><a href="/categories/apache-spark/">Apache Spark </a></li><li>Spark Operator æµ…æ</li>
    </ol>
</nav>
                        <h1 class="single-title flipInX">Spark Operator æµ…æ</h1><div class="post-meta summary-post-meta"><span class="post-category meta-item">
                                <a href="/categories/apache-spark/"><span class="svg-icon icon-folder"></span>Apache Spark</a>
                            </span><span class="post-meta-date meta-item">
                                <span class="svg-icon icon-clock"></span><time class="timeago" datetime="2021-09-21">2021-09-21</time>
                            </span><span class="post-meta-words meta-item">
                                <span class="svg-icon icon-pencil"></span>çº¦ 3698 å­—
                            </span>
                            <span class="post-meta-reading meta-item">
                                <span class="svg-icon icon-stopwatch"></span>é¢„è®¡é˜…è¯» 8 åˆ†é’Ÿ
                            </span>
                        </div>

                    </div>

                </div>

                </div></header>

        <div class="article-post toc-start">

            <div class="content-block content-block-first content-block-position">

                <div class="post single"><div class="details toc" id="toc-static"  data-kept="">
                        <div class="details-summary toc-title">
                            <span>ç›®å½•</span>
                        </div>
                        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#spark-è¿è¡Œæ—¶æ¶æ„">Spark è¿è¡Œæ—¶æ¶æ„</a></li>
    <li><a href="#spark-on-kubernetes">Spark on Kubernetes</a></li>
    <li><a href="#spark-operator-æµ…æ">Spark Operator æµ…æ</a>
      <ul>
        <li><a href="#ç³»ç»Ÿæ¶æ„">ç³»ç»Ÿæ¶æ„</a></li>
        <li><a href="#å·¥ç¨‹ç»“æ„">å·¥ç¨‹ç»“æ„</a></li>
        <li><a href="#spark-application-æ§åˆ¶å™¨">Spark Application æ§åˆ¶å™¨</a>
          <ul>
            <li><a href="#æäº¤ä½œä¸š">æäº¤ä½œä¸š</a></li>
            <li><a href="#çŠ¶æ€æµè½¬æ§åˆ¶">çŠ¶æ€æµè½¬æ§åˆ¶</a></li>
            <li><a href="#åº¦é‡ç›‘æ§">åº¦é‡ç›‘æ§</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
                    </div><div class="details admonition tip open">
        <div class="details-summary admonition-title admonition-title-none"></div>
        <div class="details-content">
            <div class="admonition-content">ä¸­ç§‹å¿«ä¹ ğŸŒ•ğŸ¥®</div>
        </div>
    </div>
<h2 id="spark-è¿è¡Œæ—¶æ¶æ„" class="headerLink"><a href="#spark-%e8%bf%90%e8%a1%8c%e6%97%b6%e6%9e%b6%e6%9e%84" class="header-mark"></a>Spark è¿è¡Œæ—¶æ¶æ„</h2><p>ç»è¿‡è¿‘å‡ å¹´çš„é«˜é€Ÿå‘å±•ï¼Œåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶çš„æ¶æ„é€æ¸è¶‹åŒã€‚èµ„æºç®¡ç†æ¨¡å—ä½œä¸ºå…¶ä¸­æœ€é€šç”¨çš„æ¨¡å—é€æ¸ä¸æ¡†æ¶è§£è€¦ï¼Œç‹¬ç«‹æˆé€šç”¨çš„ç»„ä»¶ã€‚ç›®å‰å¤§éƒ¨åˆ†åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶éƒ½æ”¯æŒæ¥å…¥å¤šæ¬¾ä¸åŒçš„èµ„æºç®¡ç†å™¨ã€‚èµ„æºç®¡ç†å™¨è´Ÿè´£é›†ç¾¤èµ„æºçš„ç®¡ç†å’Œè°ƒåº¦ï¼Œä¸ºè®¡ç®—ä»»åŠ¡åˆ†é…èµ„æºå®¹å™¨å¹¶ä¿è¯èµ„æºéš”ç¦»ã€‚Apache Spark ä½œä¸ºé€šç”¨åˆ†å¸ƒå¼è®¡ç®—å¹³å°ï¼Œç›®å‰åŒæ—¶æ”¯æŒå¤šæ¬¾èµ„æºç®¡ç†å™¨ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>YARN</li>
<li>Mesos</li>
<li>Kubernetes</li>
<li>Spark Standalone</li>
</ul>
<p>Apache Spark çš„è¿è¡Œæ—¶æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸å„ç±»èµ„æºè°ƒåº¦å™¨çš„äº¤äº’æµç¨‹æ¯”è¾ƒç±»ä¼¼ï¼š</p>
<figure><img src="/images/202109/spark-operator-brief-analysis/spark-runtime-architecture.png" width="700" height="500"/><figcaption>
            <h4>Sparkè¿è¡Œæ—¶æ¡†æ¶ï¼ˆClientæ¨¡å¼ï¼‰</h4>
        </figcaption>
</figure>

<p>å…¶ä¸­ï¼ŒDriver è´Ÿè´£ä½œä¸šé€»è¾‘çš„è°ƒåº¦å’Œä»»åŠ¡çš„ç›‘æ§ï¼Œèµ„æºç®¡ç†å™¨è´Ÿè´£èµ„æºåˆ†é…å’Œç›‘æ§ã€‚Driver æ ¹æ®éƒ¨ç½²æ¨¡å¼çš„ä¸åŒï¼Œå¯åŠ¨å’Œè¿è¡Œçš„ç‰©ç†ä½ç½®æœ‰æ‰€ä¸åŒã€‚å…¶ä¸­ï¼ŒClient æ¨¡å¼ä¸‹ï¼ŒDriver æ¨¡å—è¿è¡Œåœ¨ Spark-Submit è¿›ç¨‹ä¸­ï¼ŒCluster æ¨¡å¼ä¸‹ï¼ŒDriver çš„å¯åŠ¨è¿‡ç¨‹å’ŒExecutor ç±»ä¼¼ï¼Œè¿è¡Œåœ¨èµ„æºè°ƒåº¦å™¨åˆ†é…çš„èµ„æºå®¹å™¨å†…ã€‚</p>
<p>K8s æ˜¯ Spark åœ¨ 2.3 å¼€å§‹æ”¯æŒèµ„æºç®¡ç†å™¨ï¼Œè€Œç›¸å…³è®¨è®ºæ—©åœ¨2016å¹´å°±å·²ç»å¼€å§‹å±•å¼€ã€‚Sparkå¯¹ K8s çš„æ”¯æŒéšç€ç‰ˆæœ¬çš„è¿­ä»£ä¹Ÿé€æ­¥æ·±å…¥ï¼Œåœ¨å‘å¸ƒçš„ 3.0 ä¸­ï¼ŒSpark on K8s æä¾›äº†æ›´å¥½çš„ Kerberos æ”¯æŒå’Œèµ„æºåŠ¨æ€æ”¯æŒçš„ç‰¹æ€§ã€‚</p>
<h2 id="spark-on-kubernetes" class="headerLink"><a href="#spark-on-kubernetes" class="header-mark"></a>Spark on Kubernetes</h2><p>Kubernetes æ˜¯ç”± Google å¼€æºçš„ä¸€æ¬¾é¢å‘åº”ç”¨çš„å®¹å™¨é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†ç³»ç»Ÿ,è¿‘å¹´æ¥å‘å±•ååˆ†è¿…çŒ›ï¼Œç›¸å…³ç”Ÿæ€å·²ç»æ—¥è¶‹å®Œå–„ã€‚åœ¨ Spark å®˜æ–¹æ¥å…¥ K8s å‰ï¼Œç¤¾åŒºé€šå¸¸é€šè¿‡åœ¨ K8s é›†ç¾¤ä¸Šéƒ¨ç½²ä¸€ä¸ª Spark Standalone é›†ç¾¤çš„æ–¹å¼æ¥å®ç°åœ¨ K8s é›†ç¾¤ä¸Šè¿è¡Œ Spark ä»»åŠ¡çš„ç›®çš„ã€‚æ–¹æ¡ˆæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure><img src="/images/202109/spark-operator-brief-analysis/spark-standalone-on-k8s.png" width="700" height="500"/><figcaption>
            <h4>Spark Standalone on K8s</h4>
        </figcaption>
</figure>

<p>è¿™ä¸ªæ¨¡å¼ç®€å•æ˜“ç”¨ï¼Œä½†å­˜åœ¨ç›¸å½“å¤§çš„ç¼ºé™·ï¼š</p>
<ul>
<li>æ— æ³•æŒ‰éœ€æ‰©å±•ï¼ŒSpark Standalone éƒ¨ç½²åé›†ç¾¤è§„æ¨¡å›ºå®šï¼Œæ— æ³•æ ¹æ®ä½œä¸šéœ€æ±‚è‡ªåŠ¨æ‰©å±•é›†ç¾¤ï¼›</li>
<li>æ— æ³•åˆ©ç”¨K8såŸç”Ÿèƒ½åŠ›ï¼ŒSpark Standalone å†…å»ºçš„èµ„æºè°ƒåº¦å™¨ä¸æ”¯æŒæ‰©å±•ï¼Œéš¾ä»¥æ¥å…¥K8s è°ƒåº¦ï¼Œæ— æ³•åˆ©ç”¨ K8s æä¾›çš„äº‘åŸç”Ÿç‰¹æ€§ï¼›</li>
<li>Spark Standalone é›†ç¾¤åœ¨å¤šç§Ÿæˆ·èµ„æºéš”ç¦»ä¸Šå¤©ç”Ÿå­˜åœ¨çŸ­æ¿ã€‚</li>
</ul>
<p>Spark on Kubernetes æ–¹æ¡ˆæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¾è®¡ç»†èŠ‚å¯ä»¥å‚è€ƒï¼š<a href="https://issues.apache.org/jira/browse/SPARK-18278?spm=a2c6h.12873639.0.0.35f321c4BcQgLG" target="_blank" rel="noopener noreffer">SPARK-18278</a></p>
<figure><img src="/images/202109/spark-operator-brief-analysis/spark-on-k8s.png" width="700" height="500"/><figcaption>
            <h4>Spark on K8s</h4>
        </figcaption>
</figure>

<p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œ</p>
<ol>
<li>Spark-Submit é€šè¿‡è°ƒç”¨ K8s API åœ¨ K8s é›†ç¾¤ä¸­å¯åŠ¨ä¸€ä¸ª Spark Driver Podï¼›</li>
<li>Driver é€šè¿‡è°ƒç”¨ K8s API å¯åŠ¨ç›¸åº”çš„ Executor Podï¼Œç»„æˆä¸€ä¸ª Spark Application é›†ç¾¤ï¼Œå¹¶æŒ‡æ´¾ä½œä¸šä»»åŠ¡åˆ°è¿™äº› Executor ä¸­æ‰§è¡Œ;</li>
<li>ä½œä¸šç»“æŸåï¼ŒExecutor Pod ä¼šè¢«é”€æ¯ï¼Œè€Œ Driver Pod ä¼šæŒä¹…åŒ–ç›¸å…³æ—¥å¿—ï¼Œå¹¶ä¿æŒåœ¨ <code>completed</code> çŠ¶æ€ï¼Œç›´åˆ°ç”¨æˆ·æ‰‹æ¸…ç†æˆ–è¢« K8s é›†ç¾¤çš„åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚</li>
</ol>
<p>å½“å‰çš„æ–¹æ¡ˆå·²ç»è§£å†³äº† Spark Standalone on K8s æ–¹æ¡ˆçš„éƒ¨åˆ†ç¼ºé™·ï¼Œç„¶è€Œï¼ŒSpark Application çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ–¹å¼å’Œè°ƒåº¦æ–¹å¼ä¸ K8s å†…ç½®çš„å·¥ä½œè´Ÿè½½ï¼ˆå¦‚ Deploymentsã€DaemonSetsã€StatefulSetsç­‰ï¼‰å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œåœ¨ K8s ä¸Šæ‰§è¡Œä½œä¸šä»ç„¶å­˜åœ¨ä¸å°‘é—®é¢˜ï¼š</p>
<ol>
<li>Spark-submit åœ¨ K8s é›†ç¾¤ä¹‹å¤–ï¼Œä½¿ç”¨éå£°æ˜å¼çš„æäº¤æ¥å£ï¼›</li>
<li>Spark Application ä¹‹é—´æ²¡æœ‰ååŒè°ƒåº¦ï¼Œåœ¨å°é›†ç¾¤ä¸­å¾ˆå®¹æ˜“å‡ºç°è°ƒåº¦é¥¿æ­»çš„æƒ…å†µï¼›</li>
<li>éœ€è¦æ‰‹åŠ¨é…ç½®ç½‘ç»œï¼Œæ¥è®¿é—® WebUIï¼›</li>
<li>ä»»åŠ¡ç›‘æ§æ¯”è¾ƒéº»çƒ¦ï¼Œæ²¡æœ‰æ¥å…¥ Prometheus é›†ç¾¤ç›‘æ§ã€‚</li>
</ol>
<p>å½“ç„¶Spark on Kubernetes æ–¹æ¡ˆç›®å‰è¿˜åœ¨å¿«é€Ÿå¼€å‘ä¸­ï¼Œæ›´å¤šç‰¹æ€§ä¸ä¹…ä¼šå‘å¸ƒå‡ºæ¥ï¼Œç›¸ä¿¡æœªæ¥å’Œ K8s çš„é›†æˆä¼šæ›´åŠ ç´§å¯†å’Œ Nativeï¼Œè¿™äº›ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŠ¨æ€èµ„æºåˆ†é…å’Œå¤–éƒ¨ Shuffle æœåŠ¡</li>
<li>æœ¬åœ°æ–‡ä»¶ä¾èµ–ç®¡ç†å™¨</li>
<li>Spark Application ç®¡ç†å™¨</li>
<li>ä½œä¸šé˜Ÿåˆ—å’Œèµ„æºç®¡ç†å™¨</li>
</ul>
<h2 id="spark-operator-æµ…æ" class="headerLink"><a href="#spark-operator-%e6%b5%85%e6%9e%90" class="header-mark"></a>Spark Operator æµ…æ</h2><p>åœ¨åˆ†æ Spark Operator çš„å®ç°ä¹‹å‰ï¼Œå…ˆç®€å•æ¢³ç†ä¸‹ Kubernetes Operator çš„åŸºæœ¬æ¦‚å¿µã€‚Kubernetes Operator æ˜¯ç”± CoreOS å¼€å‘çš„ Kubernetes æ‰©å±•ç‰¹æ€§ï¼Œç›®æ ‡æ˜¯é€šè¿‡å®šä¹‰ä¸€ç³»åˆ— CRD å’Œå®ç°æ§åˆ¶å™¨ï¼Œå°†ç‰¹å®šé¢†åŸŸçš„åº”ç”¨ç¨‹åºè¿ç»´æŠ€æœ¯å’ŒçŸ¥è¯†ï¼ˆå¦‚éƒ¨ç½²æ–¹æ³•ã€ç›‘æ§ã€æ•…éšœæ¢å¤ç­‰ï¼‰é€šè¿‡ä»£ç çš„æ–¹å¼å›ºåŒ–ä¸‹æ¥ã€‚Spark Operator æ˜¯ Google åŸºäº Operator æ¨¡å¼å¼€å‘çš„ä¸€æ¬¾çš„å·¥å…·(<a href="https://github.com/GoogleCloudPlatform/spark-on-k8s-operator" target="_blank" rel="noopener noreffer">https://github.com/GoogleCloudPlatform/spark-on-k8s-operator</a>)ï¼Œç”¨äºé€šè¿‡å£°æ˜å¼çš„æ–¹å¼å‘ K8s é›†ç¾¤æäº¤ Spark ä½œä¸šã€‚ä½¿ç”¨ Spark Operator ç®¡ç† Spark åº”ç”¨ï¼Œèƒ½æ›´å¥½çš„åˆ©ç”¨ K8s åŸç”Ÿèƒ½åŠ›æ§åˆ¶å’Œç®¡ç† Spark åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬åº”ç”¨çŠ¶æ€ç›‘æ§ã€æ—¥å¿—è·å–ã€åº”ç”¨è¿è¡Œæ§åˆ¶ç­‰ï¼Œå¼¥è¡¥ Spark on K8s æ–¹æ¡ˆåœ¨é›†æˆ K8s ä¸Šä¸å…¶ä»–ç±»å‹çš„è´Ÿè½½ä¹‹é—´å­˜åœ¨çš„å·®è·ã€‚
ä¸‹é¢ç®€å•åˆ†æä¸‹Spark Operatorçš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 id="ç³»ç»Ÿæ¶æ„" class="headerLink"><a href="#%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84" class="header-mark"></a>ç³»ç»Ÿæ¶æ„</h3><figure><img src="/images/202109/spark-operator-brief-analysis/spark-operator-architecture.png" width="700" height="500"/><figcaption>
            <h4>Spark Operator æ¶æ„</h4>
        </figcaption>
</figure>

<p>å¯ä»¥çœ‹å‡ºï¼ŒSpark Operator ç›¸æ¯” Spark on K8sï¼Œæ¶æ„ä¸Šè¦å¤æ‚ä¸€äº›ï¼Œå®é™…ä¸Š Spark Operator é›†æˆäº† Spark on K8s çš„æ–¹æ¡ˆï¼Œæä¾›äº†æ›´å…¨é¢ç®¡æ§ç‰¹æ€§ã€‚é€šè¿‡ Spark Operatorï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨æ›´åŠ ç¬¦åˆ K8s ç†å¿µçš„æ–¹å¼æ¥æ§åˆ¶ Spark åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚Spark Operator åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªç»„ä»¶ï¼š</p>
<ol>
<li>SparkApplication æ§åˆ¶å™¨ï¼šè¯¥æ§åˆ¶å™¨ç”¨äºåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤SparkApplicationå¯¹è±¡ï¼ŒåŒæ—¶æ§åˆ¶å™¨è¿˜ä¼šç›‘æ§ç›¸åº”çš„äº‹ä»¶,æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œï¼›</li>
<li>Submission Runnerï¼šè´Ÿè´£è°ƒç”¨ spark-submit æäº¤ Spark ä½œä¸šï¼Œä½œä¸šæäº¤çš„æµç¨‹å®Œå…¨å¤ç”¨ Spark on K8s çš„æ¨¡å¼ï¼›</li>
<li>Spark Pod Monitorï¼šç›‘æ§ Spark ä½œä¸šç›¸å…³ Pod çš„çŠ¶æ€ï¼Œå¹¶åŒæ­¥åˆ°æ§åˆ¶å™¨ä¸­ï¼›</li>
<li>Mutating Admission Webhookï¼šå¯é€‰æ¨¡å—ï¼ŒåŸºäºæ³¨è§£æ¥å®ç° Driver/Executor Pod çš„ä¸€äº›å®šåˆ¶åŒ–éœ€æ±‚ï¼›</li>
<li>SparkCtlï¼šç”¨äºå’Œ Spark Operator äº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li>
</ol>
<p>Spark Operator é™¤äº†å®ç°åŸºæœ¬çš„ä½œä¸šæäº¤å¤–ï¼Œè¿˜æ”¯æŒå¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>å£°æ˜å¼çš„ä½œä¸šç®¡ç†ï¼›</li>
<li>æ”¯æŒæ›´æ–° SparkApplication å¯¹è±¡åè‡ªåŠ¨é‡æ–°æäº¤ä½œä¸šï¼›</li>
<li>æ”¯æŒå¯é…ç½®çš„é‡å¯ç­–ç•¥ï¼›</li>
<li>æ”¯æŒå¤±è´¥é‡è¯•ï¼›</li>
<li>é›†æˆ Prometheusï¼Œå¯ä»¥æ”¶é›†å’Œè½¬å‘ Spark åº”ç”¨çº§åˆ«çš„åº¦é‡å’Œ Driver/Executor çš„åº¦é‡åˆ° Prometheus ä¸­ã€‚</li>
</ul>
<h3 id="å·¥ç¨‹ç»“æ„" class="headerLink"><a href="#%e5%b7%a5%e7%a8%8b%e7%bb%93%e6%9e%84" class="header-mark"></a>å·¥ç¨‹ç»“æ„</h3><p>Spark Operator çš„é¡¹ç›®æ˜¯æ ‡å‡†çš„ K8s Operator ç»“æ„ï¼Œå…¶ä¸­æœ€é‡è¦çš„åŒ…æ‹¬ï¼š</p>
<ul>
<li>manifestï¼šå®šä¹‰äº† Spark ç›¸å…³çš„ CRDï¼ŒåŒ…æ‹¬:
<ul>
<li>ScheduledSparkApplicationï¼šè¡¨ç¤ºä¸€ä¸ªå®šæ—¶æ‰§è¡Œçš„ Spark ä½œä¸š</li>
<li>SparkApplicationï¼šè¡¨ç¤ºä¸€ä¸ª Spark ä½œä¸š</li>
</ul>
</li>
<li>pkgï¼šå…·ä½“çš„ Operator é€»è¾‘å®ç°
<ul>
<li>apiï¼šå®šä¹‰äº† Operator çš„å¤šä¸ªç‰ˆæœ¬çš„ API</li>
<li>clientï¼šç”¨äºå¯¹æ¥çš„ client-go SDK</li>
<li>controllerï¼šè‡ªå®šä¹‰æ§åˆ¶å™¨çš„å®ç°,åŒ…æ‹¬ï¼š
<ul>
<li>ScheduledSparkApplication æ§åˆ¶å™¨</li>
<li>SparkApplication æ§åˆ¶å™¨</li>
</ul>
</li>
<li>batchscheduler: æ‰¹å¤„ç†è°ƒåº¦å™¨é›†æˆæ¨¡å—, ç›®å‰å·²ç»é›†æˆäº† K8s volcano è°ƒåº¦å™¨</li>
</ul>
</li>
<li>spark-dockerï¼šspark docker é•œåƒ</li>
<li>sparkctlï¼šspark operator å‘½ä»¤è¡Œå·¥å…·</li>
</ul>
<h3 id="spark-application-æ§åˆ¶å™¨" class="headerLink"><a href="#spark-application-%e6%8e%a7%e5%88%b6%e5%99%a8" class="header-mark"></a>Spark Application æ§åˆ¶å™¨</h3><p>æ§åˆ¶å™¨çš„ä»£ç ä¸»è¦ä½äº<code>pkg/controller/sparkapplication/controller.go</code>ä¸­ã€‚</p>
<h4 id="æäº¤ä½œä¸š" class="headerLink"><a href="#%e6%8f%90%e4%ba%a4%e4%bd%9c%e4%b8%9a" class="header-mark"></a>æäº¤ä½œä¸š</h4><p>æäº¤ä½œä¸šçš„æäº¤ä½œä¸šçš„ä¸»æµç¨‹åœ¨ submitSparkApplication æ–¹æ³•ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// controller.go
</span><span class="c1">// submitSparkApplication creates a new submission for the given SparkApplication and submits it using spark-submit.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Controller</span><span class="p">)</span> <span class="nf">submitSparkApplication</span><span class="p">(</span><span class="nx">app</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span><span class="p">)</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">app</span><span class="p">.</span><span class="nf">PrometheusMonitoringEnabled</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">...</span>
        <span class="nf">configPrometheusMonitoring</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">kubeClient</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Use batch scheduler to perform scheduling task before submitting (before build command arguments).
</span><span class="c1"></span>    <span class="k">if</span> <span class="nx">needScheduling</span><span class="p">,</span> <span class="nx">scheduler</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">shouldDoBatchScheduling</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="nx">needScheduling</span> <span class="p">{</span>
        <span class="nx">newApp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">scheduler</span><span class="p">.</span><span class="nf">DoBatchSchedulingOnSubmission</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
        <span class="o">...</span>
        <span class="c1">//Spark submit will use the updated app to submit tasks(Spec will not be updated into API server)
</span><span class="c1"></span>        <span class="nx">app</span> <span class="p">=</span> <span class="nx">newApp</span>
    <span class="p">}</span>

    <span class="nx">driverPodName</span> <span class="o">:=</span> <span class="nf">getDriverPodName</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
    <span class="nx">submissionID</span> <span class="o">:=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nf">New</span><span class="p">().</span><span class="nf">String</span><span class="p">()</span>
    <span class="nx">submissionCmdArgs</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">buildSubmissionCommandArgs</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">driverPodName</span><span class="p">,</span> <span class="nx">submissionID</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="c1">// Try submitting the application by running spark-submit.
</span><span class="c1"></span>    <span class="nx">submitted</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">runSparkSubmit</span><span class="p">(</span><span class="nf">newSubmission</span><span class="p">(</span><span class="nx">submissionCmdArgs</span><span class="p">,</span> <span class="nx">app</span><span class="p">))</span>
    <span class="o">...</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span> <span class="p">=</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplicationStatus</span><span class="p">{</span>
        <span class="nx">SubmissionID</span><span class="p">:</span> <span class="nx">submissionID</span><span class="p">,</span>
        <span class="nx">AppState</span><span class="p">:</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">ApplicationState</span><span class="p">{</span>
            <span class="nx">State</span><span class="p">:</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SubmittedState</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">DriverInfo</span><span class="p">:</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">DriverInfo</span><span class="p">{</span>
            <span class="nx">PodName</span><span class="p">:</span> <span class="nx">driverPodName</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nx">SubmissionAttempts</span><span class="p">:</span>        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SubmissionAttempts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">ExecutionAttempts</span><span class="p">:</span>         <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutionAttempts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">LastSubmissionAttemptTime</span><span class="p">:</span> <span class="nx">metav1</span><span class="p">.</span><span class="nf">Now</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="nx">c</span><span class="p">.</span><span class="nf">recordSparkApplicationEvent</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>

    <span class="nx">service</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createSparkUIService</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">kubeClient</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="nx">ingress</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">createSparkUIIngress</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="o">*</span><span class="nx">service</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">ingressURLFormat</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">kubeClient</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">app</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>æäº¤ä½œä¸šçš„æ ¸å¿ƒé€»è¾‘åœ¨ <code>submission.go</code> è¿™ä¸ªæ¨¡å—ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// submission.go
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">runSparkSubmit</span><span class="p">(</span><span class="nx">submission</span> <span class="o">*</span><span class="nx">submission</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sparkHome</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">LookupEnv</span><span class="p">(</span><span class="nx">sparkHomeEnvVar</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">!</span><span class="nx">present</span> <span class="p">{</span>
        <span class="nx">glog</span><span class="p">.</span><span class="nf">Error</span><span class="p">(</span><span class="s">&#34;SPARK_HOME is not specified&#34;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">command</span> <span class="p">=</span> <span class="nx">filepath</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="nx">sparkHome</span><span class="p">,</span> <span class="s">&#34;/bin/spark-submit&#34;</span><span class="p">)</span>

    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nf">execCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
    <span class="nx">glog</span><span class="p">.</span><span class="nf">V</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;spark-submit arguments: %v&#34;</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span>
    <span class="nx">output</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nf">Output</span><span class="p">()</span>
    <span class="nx">glog</span><span class="p">.</span><span class="nf">V</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;spark-submit output: %s&#34;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">output</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">errorMsg</span> <span class="kt">string</span>
        <span class="k">if</span> <span class="nx">exitErr</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.(</span><span class="o">*</span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExitError</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
            <span class="nx">errorMsg</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">exitErr</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// The driver pod of the application already exists.
</span><span class="c1"></span>        <span class="k">if</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="nx">errorMsg</span><span class="p">,</span> <span class="nx">podAlreadyExistsErrorCode</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">glog</span><span class="p">.</span><span class="nf">Warningf</span><span class="p">(</span><span class="s">&#34;trying to resubmit an already submitted SparkApplication %s/%s&#34;</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">errorMsg</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;failed to run spark-submit for SparkApplication %s/%s: %s&#34;</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">errorMsg</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;failed to run spark-submit for SparkApplication %s/%s: %v&#34;</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">submission</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">buildSubmissionCommandArgs</span><span class="p">(</span><span class="nx">app</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span><span class="p">,</span> <span class="nx">driverPodName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">submissionID</span> <span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="nx">options</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">addDriverConfOptions</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">submissionID</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="nx">options</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nf">addExecutorConfOptions</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">submissionID</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">getMasterURL</span><span class="p">()</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">kubernetesServiceHost</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="nx">kubernetesServiceHostEnvVar</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="nx">kubernetesServicePort</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="nx">kubernetesServicePortEnvVar</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;k8s://https://%s:%s&#34;</span><span class="p">,</span> <span class="nx">kubernetesServiceHost</span><span class="p">,</span> <span class="nx">kubernetesServicePort</span><span class="p">),</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥çœ‹å‡º,</p>
<ol>
<li>å¯ä»¥é…ç½®æ§åˆ¶å™¨å¯ç”¨ Prometheus è¿›è¡Œåº¦é‡æ”¶é›†ï¼›</li>
<li>Spark Operator é€šè¿‡æ‹¼è£…ä¸€ä¸ª spark-submit å‘½ä»¤å¹¶æ‰§è¡Œï¼Œå®ç°æäº¤ Spark ä½œä¸šåˆ° K8s é›†ç¾¤ä¸­çš„ç›®çš„ï¼›</li>
<li>åœ¨æ¯æ¬¡æäº¤å‰ï¼ŒSpark Operator éƒ½ä¼šç”Ÿæˆä¸€ä¸ª UUID ä½œä¸º Session IDï¼Œå¹¶é€šè¿‡ Spark ç›¸å…³é…ç½®å¯¹ Driver/Executor çš„ Pod è¿›è¡Œæ ‡è®°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª ID æ¥è·Ÿè¸ªå’Œæ§åˆ¶è¿™ä¸ª Spark ä½œä¸šï¼›</li>
<li>Controller é€šè¿‡ç›‘æ§ç›¸å…³ä½œä¸šçš„ Pod çš„çŠ¶æ€æ¥æ›´æ–° SparkApplication çš„çŠ¶æ€ï¼ŒåŒæ—¶é©±åŠ¨ SparkApplication å¯¹è±¡çš„çŠ¶æ€æµè½¬ï¼›</li>
<li>æäº¤æˆåŠŸåï¼Œè¿˜ä¼šåšå¦‚ä¸‹å‡ ä»¶äº‹æƒ…:</li>
<li>æ›´æ–°ä½œä¸šçš„çŠ¶æ€ï¼›</li>
<li>å¯åŠ¨ä¸€ä¸ªServiceï¼Œå¹¶é…ç½®å¥½Ingressï¼Œæ–¹ä¾¿ç”¨æˆ·è®¿é—®Spark WebUIã€‚</li>
</ol>
<h4 id="çŠ¶æ€æµè½¬æ§åˆ¶" class="headerLink"><a href="#%e7%8a%b6%e6%80%81%e6%b5%81%e8%bd%ac%e6%8e%a7%e5%88%b6" class="header-mark"></a>çŠ¶æ€æµè½¬æ§åˆ¶</h4><p>åœ¨ Spark Operator ä¸­ï¼ŒController ä½¿ç”¨çŠ¶æ€æœºæ¥ç»´æŠ¤ Spark Application çš„çŠ¶æ€ä¿¡æ¯ï¼ŒçŠ¶æ€æµè½¬å’Œ Action çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure><img src="/images/202109/spark-operator-brief-analysis/state-machine-for-sparkapplication.png" width="700" height="500"/><figcaption>
            <h4>State Machine for SparkApplication</h4>
        </figcaption>
</figure>

<p>ä½œä¸šæäº¤åï¼ŒSpark Application çš„çŠ¶æ€æ›´æ–°éƒ½æ˜¯é€šè¿‡ <code>getAndUpdateAppState()</code> æ–¹æ³•æ¥å®ç°çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// controller.go
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Controller</span><span class="p">)</span> <span class="nf">getAndUpdateAppState</span><span class="p">(</span><span class="nx">app</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">getAndUpdateDriverState</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">getAndUpdateExecutorState</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
<span class="c1">// getAndUpdateDriverState finds the driver pod of the application
</span><span class="c1">// and updates the driver state based on the current phase of the pod.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Controller</span><span class="p">)</span> <span class="nf">getAndUpdateDriverState</span><span class="p">(</span><span class="nx">app</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="c1">// Either the driver pod doesn&#39;t exist yet or its name has not been updated.
</span><span class="c1"></span>    <span class="o">...</span>
    <span class="nx">driverPod</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">getDriverPod</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="nx">driverPod</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">AppState</span><span class="p">.</span><span class="nx">ErrorMessage</span> <span class="p">=</span> <span class="s">&#34;Driver Pod not found&#34;</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">AppState</span><span class="p">.</span><span class="nx">State</span> <span class="p">=</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">FailingState</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">TerminationTime</span> <span class="p">=</span> <span class="nx">metav1</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    
    <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">SparkApplicationID</span> <span class="p">=</span> <span class="nf">getSparkApplicationID</span><span class="p">(</span><span class="nx">driverPod</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="nx">newState</span> <span class="o">:=</span> <span class="nf">driverStateToApplicationState</span><span class="p">(</span><span class="nx">driverPod</span><span class="p">.</span><span class="nx">Status</span><span class="p">)</span>
    <span class="c1">// Only record a driver event if the application state (derived from the driver pod phase) has changed.
</span><span class="c1"></span>    <span class="k">if</span> <span class="nx">newState</span> <span class="o">!=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">AppState</span><span class="p">.</span><span class="nx">State</span> <span class="p">{</span>
        <span class="nx">c</span><span class="p">.</span><span class="nf">recordDriverEvent</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">driverPod</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Phase</span><span class="p">,</span> <span class="nx">driverPod</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">AppState</span><span class="p">.</span><span class="nx">State</span> <span class="p">=</span> <span class="nx">newState</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// getAndUpdateExecutorState lists the executor pods of the application
</span><span class="c1">// and updates the executor state based on the current phase of the pods.
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Controller</span><span class="p">)</span> <span class="nf">getAndUpdateExecutorState</span><span class="p">(</span><span class="nx">app</span> <span class="o">*</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SparkApplication</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">pods</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">getExecutorPods</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="nx">executorStateMap</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">executorApplicationID</span> <span class="kt">string</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pod</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">pods</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">util</span><span class="p">.</span><span class="nf">IsExecutorPod</span><span class="p">(</span><span class="nx">pod</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">newState</span> <span class="o">:=</span> <span class="nf">podPhaseToExecutorState</span><span class="p">(</span><span class="nx">pod</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">Phase</span><span class="p">)</span>
            <span class="nx">oldState</span><span class="p">,</span> <span class="nx">exists</span> <span class="o">:=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">[</span><span class="nx">pod</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span>
            <span class="c1">// Only record an executor event if the executor state is new or it has changed.
</span><span class="c1"></span>            <span class="k">if</span> <span class="p">!</span><span class="nx">exists</span> <span class="o">||</span> <span class="nx">newState</span> <span class="o">!=</span> <span class="nx">oldState</span> <span class="p">{</span>
                <span class="nx">c</span><span class="p">.</span><span class="nf">recordExecutorEvent</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">newState</span><span class="p">,</span> <span class="nx">pod</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">executorStateMap</span><span class="p">[</span><span class="nx">pod</span><span class="p">.</span><span class="nx">Name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">newState</span>

            <span class="k">if</span> <span class="nx">executorApplicationID</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
                <span class="nx">executorApplicationID</span> <span class="p">=</span> <span class="nf">getSparkApplicationID</span><span class="p">(</span><span class="nx">pod</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ApplicationID label can be different on driver/executors. Prefer executor ApplicationID if set.
</span><span class="c1"></span>    <span class="c1">// Refer https://issues.apache.org/jira/projects/SPARK/issues/SPARK-25922 for details.
</span><span class="c1"></span>    <span class="o">...</span>
    <span class="k">if</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">v1beta2</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">execStatus</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">executorStateMap</span> <span class="p">{</span>
        <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">execStatus</span>
    <span class="p">}</span>

    <span class="c1">// Handle missing/deleted executors.
</span><span class="c1"></span>    <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">oldStatus</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">,</span> <span class="nx">exists</span> <span class="o">:=</span> <span class="nx">executorStateMap</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">!</span><span class="nf">isExecutorTerminated</span><span class="p">(</span><span class="nx">oldStatus</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">!</span><span class="nx">exists</span> <span class="p">{</span>
            <span class="c1">// If ApplicationState is SUCCEEDING, in other words, the driver pod has been completed
</span><span class="c1"></span>            <span class="c1">// successfully. The executor pods terminate and are cleaned up, so we could not found
</span><span class="c1"></span>            <span class="c1">// the executor pod, under this circumstances, we assume the executor pod are completed.
</span><span class="c1"></span>            <span class="k">if</span> <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">AppState</span><span class="p">.</span><span class="nx">State</span> <span class="o">==</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">SucceedingState</span> <span class="p">{</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">ExecutorCompletedState</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">glog</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="s">&#34;Executor pod %s not found, assuming it was deleted.&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
                <span class="nx">app</span><span class="p">.</span><span class="nx">Status</span><span class="p">.</span><span class="nx">ExecutorState</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v1beta2</span><span class="p">.</span><span class="nx">ExecutorFailedState</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>ä»è¿™æ®µä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒSpark Application æäº¤åï¼ŒController ä¼šé€šè¿‡ç›‘å¬ Driver Pod å’ŒExecutor Pod çŠ¶æ€æ¥è®¡ç®— Spark Application çš„çŠ¶æ€ï¼Œæ¨åŠ¨çŠ¶æ€æœºçš„æµè½¬ã€‚</p>
<h4 id="åº¦é‡ç›‘æ§" class="headerLink"><a href="#%e5%ba%a6%e9%87%8f%e7%9b%91%e6%8e%a7" class="header-mark"></a>åº¦é‡ç›‘æ§</h4><p>å¦‚æœä¸€ä¸ª SparkApplication ç¤ºä¾‹é…ç½®äº†å¼€å¯åº¦é‡ç›‘æ§ç‰¹æ€§ï¼Œé‚£ä¹ˆ Spark Operator ä¼šåœ¨Spark-Submit æäº¤å‚æ•°ä¸­å‘ Driver å’Œ Executor çš„ JVM å‚æ•°ä¸­æ·»åŠ ç±»ä¼¼<code>-javaagent:/prometheus/jmx_prometheus_javaagent-0.11.0.jar=8090:/etc/metrics/conf/prometheus.yaml</code>çš„ JavaAgent å‚æ•°æ¥å¼€å¯ SparkApplication åº¦é‡ç›‘æ§ï¼Œå®ç°é€šè¿‡ JmxExporter å‘ Prometheus å‘é€åº¦é‡æ•°æ®ã€‚</p>
<figure><img src="/images/202109/spark-operator-brief-analysis/prometheus-architecture.png" width="700" height="500"/><figcaption>
            <h4>Prometheus æ¶æ„</h4>
        </figcaption>
</figure>

</div><footer>
                        <div class="post">


<div class="post-share"><div class="share-link">
        <a class="share-icon share-twitter" href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://dcoliversun.github.io/spark-operator-brief-analysis/" data-title="Spark Operator æµ…æ" data-hashtags="Spark,Operator,Kubernetes"><span class="svg-social-icon icon-twitter"></span></a>
    </div><div class="share-link">
        <a class="share-icon share-facebook" href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://dcoliversun.github.io/spark-operator-brief-analysis/" data-hashtag="Spark"><span class="svg-social-icon icon-facebook"></span></a>
    </div><div class="share-link">
        <a class="share-icon share-linkedin" href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://dcoliversun.github.io/spark-operator-brief-analysis/"><span class="svg-social-icon icon-linkedin"></span></a>
    </div></div>




<div class="block-author">
    <div class="author-avatar"><a href="https://dcoliversun.github.io" target="_blank"><img alt="Qian Sun -- CoderğŸ’» | BloggerğŸ“ | SwimmerğŸŠâ€â™€ï¸" src="https://dcoliversun.github.io/images/me/avatar.png"></a></div>
    <div class="author-info">
        <div class="name"><a href="https://dcoliversun.github.io" target="_blank"></a></div>
        <div class="number-posts">Qian Sun -- CoderğŸ’» | BloggerğŸ“ | SwimmerğŸŠâ€â™€ï¸</span></div>
    </div>
</div>


<div class="post-tags"><a href="/tags/spark/" class="tag">Spark</a><a href="/tags/operator/" class="tag">Operator</a><a href="/tags/kubernetes/" class="tag">Kubernetes</a></div></div>
                </footer></div>

        <div id="toc-final"></div>
        </div>

    
    </article>
    <section class="page single comments content-block-position">
        <h1 class="display-hidden">ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸</h1><div id="comments"></div></section></div>

</main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://ublogger.netlify.app/?utm_source=https://dcoliversun.github.io&utm_medium=footer&utm_campaign=config&utm_term=2.0.1" target="_blank" title="uBlogger 2.0.1">uBlogger</a>
                </div><div class="footer-line"><i class="svg-icon icon-copyright"></i><span>2020 - 2022</span><span class="author">&nbsp;<a href="https://dcoliversun.github.io" target="_blank">Qian Sun</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <aside id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="svg-icon icon-arrow-up"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="svg-icon icon-comments-fixed"></i>
            </a>
        </aside><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script src="/lib/autocomplete/autocomplete.min.js"></script><script src="/lib/lunr/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="/lib/clipboard/clipboard.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/prismjs/prism.js"></script><script src="/lib/katex/katex.min.js"></script><script src="/lib/katex/auto-render.min.js"></script><script src="/lib/katex/copy-tex.min.js"></script><script src="/lib/katex/mhchem.min.js"></script><script src="/lib/cookieconsent/cookieconsent.min.js"></script><script>window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script><script>
                window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
                gtag('config', 'G-K2QWGME5NC', { 'anonymize_ip': true });
            </script><script src="https://www.googletagmanager.com/gtag/js?id=G-K2QWGME5NC" async></script></body>
</html>
